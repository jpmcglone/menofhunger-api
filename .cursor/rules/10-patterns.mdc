---
description: Preferred patterns and nuanced conventions learned from prior work.
---

## Prefer “best-effort” robustness
- When external dependencies fail (Twilio, API-to-API calls), fail gracefully with a clear `ServiceUnavailableException` and consistent `meta.errors[]`.
- Avoid crashing the process for user-caused issues (bad input, blocked CORS origins). Log and reject safely.

## CORS and environment config
- Do not read `process.env` inside services/controllers.
- Use centralized config access (`AppConfigService`) for all env, especially security-sensitive settings.

## Idempotent seeds
- Seeds must be idempotent and safe to run multiple times.
- For prod seed user:
  - if found by id/phone/username, **update** critical flags (e.g. `siteAdmin`) rather than returning early.

## Admin APIs
- Keep admin endpoints under `/admin/*` and protect via admin guard returning 404 for non-admins.
- Default to pagination-friendly APIs:
  - `take + 1` pattern
  - `cursor` for pagination

## Username rules
- Public username validation is stricter (product rules).
- Admin username validation can be looser, but must be explicitly **admin-only** and not reused for public flows by accident.

