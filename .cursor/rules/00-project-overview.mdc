---
description: menofhunger-api core conventions (Nest + Prisma)
alwaysApply: true
---

## API contract (must follow)
- **Success**: `{ data: T }` (or `{ data: T[], pagination }` for lists)
- **Errors**: `{ meta: { status, errors: [...] } }` (global exception filter)
- **Controllers**: return the envelope explicitly (don’t return raw payloads)

## When you change an API response
- Update `menofhunger-api/src/common/dto/**`
- Update `menofhunger-www/types/api.ts`
- Run `npx nuxi typecheck` + `node scripts/validate-api-types.mjs` (www)

## Auth + admin
- Cookie auth (HTTP-only cookies)
- Admin-only surfaces must be hidden from non-admins (**404**, not 401/403)

## Validation + config
- Validate bodies with Zod; use clear user-facing messages
- Don’t read `process.env` in services/controllers; use `AppConfigService`

## Prisma migrations
- Schema change: edit `prisma/schema.prisma`
- Create SQL: `npm run prisma:migrate:create -- <name>`
- Apply: `npm run prisma:migrate:deploy`
- Generate: `npx prisma generate`

## After substantive changes
- `npm run build`

