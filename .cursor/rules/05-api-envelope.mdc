---
description: API response envelope contract — every success/error response shape.
---

## Envelope contract (must follow)

Every HTTP response must use the envelope. Never return raw payload at top level.

**Success envelope:**

```ts
{
  "data": ResponseData | ResponseData[]   // single resource or list; always key "data"
  "pagination"?: { ... }                  // when applicable (lists), always same shape
}
```

**Error envelope:** (handled by global exception filter)

```ts
{
  "meta": {
    "status": number,
    "errors": Array<{ code: number, message: string, reason?: string }>
  }
}
```

- **Never** return `{ SomeKey: value }` at top level — the payload must sit under `"data"`.
- **Never** return a bare array `[ Item, ... ]` — use `{ "data": [ Item, ... ] }`.
- **Never** use `ok: true` / `ok: false` in responses; use the envelope and `meta` for errors.

## Documenting endpoints

Use this style when describing an endpoint:

- `METHOD /path -> ResponseData` — single resource, e.g. `GET /users/:id -> User`
- `METHOD /path -> [ResponseData]` — list, e.g. `GET /users -> [User]`

Examples:

- `GET /users` → `[User]` (envelope: `{ data: User[], pagination?: { nextCursor, ... } }`)
- `GET /users/:id` → `User` (envelope: `{ data: User }`)
- `POST /auth/verify` → `{ user, token }` (envelope: `{ data: { user, token } }`)

`ResponseData` can be a primitive, an object, an array of objects, or a compound object (e.g. `{ user, token }`). The envelope always wraps it under `data`.

## Pagination

When a list endpoint supports cursor/counts, include a sibling `pagination` object (same shape across list endpoints), e.g.:

- `nextCursor?: string | null`
- `counts?: { all, public, verifiedOnly, premiumOnly } | null`
- `totalOnline?: number` (e.g. presence)
- `nextUserCursor?`, `nextPostCursor?` (e.g. mixed search)

Do not put cursor or counts at top level; keep them under `pagination`.

## Controllers

- Controllers must **explicitly** return `{ data: ... }` (and optionally `pagination`). Do not rely on the interceptor to wrap a raw return; return the envelope from the controller so the contract is clear at the call site.
